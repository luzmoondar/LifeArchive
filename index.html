<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏÇ∂Í∏∞Î°ùÏÜå</title>
    <!-- Î≥¥Ïïà Í∞ïÌôîÎ•º ÏúÑÌïú CSP ÏÑ§Ï†ï -->
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self' https://*.supabase.co https://cdn.jsdelivr.net;">
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè†</text></svg>">
</head>

<body>
    <div class="app-container">
        <!-- New Header Area -->
        <div class="app-title-bar">
            <h1>Life Archive</h1>
            <div class="title-bar-actions">
                <div id="sync-status-indicator" class="sync-status offline"><span></span> ÎåÄÍ∏∞ Ï§ë</div>
                <button onclick="manualSync()" class="sync-manual-btn">ÎèôÍ∏∞Ìôî</button>
                <button id="btn-reset-all" class="reset-btn" style="display: none;">Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî</button>
                <button id="btn-logout" class="logout-btn" style="display: none;">Î°úÍ∑∏ÏïÑÏõÉ</button>
                <button id="btn-delete-account" class="delete-btn"
                    style="display: none; background-color: var(--danger); color: white; border: none; padding: 6px 14px; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.2s;">ÌöåÏõêÌÉàÌá¥</button>
            </div>
        </div>

        <div class="app-body">
            <header class="main-header">
                <nav class="tab-nav">
                    <button class="tab-btn active" data-tab="stats">ÏûêÏÇ∞ ÌòÑÌô©</button>
                    <button class="tab-btn" data-tab="account">Í∞ÄÍ≥ÑÎ∂Ä</button>
                    <button class="tab-btn" data-tab="detail">ÏÉÅÏÑ∏Í∞ÄÍ≥ÑÎ∂Ä</button>
                    <button class="tab-btn" data-tab="monthly">ÏÉùÌôúÎ®ºÏä¨Î¶¨</button>
                    <button class="tab-btn" data-tab="wedding">Í≤∞ÌòºÏãù</button>
                </nav>
            </header>

            <main class="content-area">

                <!-- Detailed Account Tab -->
                <section id="detail" class="tab-content">
                    <div class="detail-card">
                        <!-- Ïó∞Ïõî ÎÑ§ÎπÑÍ≤åÏù¥ÌÑ∞ -->
                        <div class="detail-month-nav">
                            <button id="detail-prev-month" class="month-nav-btn">&#8249;</button>
                            <span id="detail-month-label" class="month-nav-label">2026ÎÖÑ 02Ïõî</span>
                            <button id="detail-next-month" class="month-nav-btn">&#8250;</button>
                        </div>

                        <div class="detail-grid">
                            <div class="section-card">
                                <div class="section-header">
                                    <div class="title-with-budget">
                                        <h4>Í∞úÏù∏ÏÜåÎπÑ</h4>
                                        <div class="budget-input-group">
                                            <label>Î™©ÌëúÏòàÏÇ∞:</label>
                                            <input type="number" id="personal-budget" placeholder="0">
                                            <span>Ïõê</span>
                                        </div>
                                    </div>
                                    <button class="add-btn" id="add-personal-row">+</button>
                                </div>
                                <div class="table-responsive">
                                    <table class="detail-table" id="personal-detail-table">
                                        <thead>
                                            <tr>
                                                <th style="width: 40px;">No.</th>
                                                <th>ÎÇ¥Ïö©</th>
                                                <th>Í∏àÏï°</th>
                                                <th style="width: 90px;"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="personal-table-body">
                                            <!-- rows added here -->
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <td colspan="2" class="total-label">Ìï©Í≥Ñ</td>
                                                <td colspan="2" class="total-amount" id="personal-total">0Ïõê</td>
                                            </tr>
                                            <tr class="remaining-row">
                                                <td colspan="2" class="total-label">ÎÇ®ÏùÄ Í∏àÏï°</td>
                                                <td colspan="2" class="remaining-amount" id="personal-remaining">0Ïõê</td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>

                            <div class="section-card">
                                <div class="section-header">
                                    <div class="title-with-budget">
                                        <h4>Í≥µÏö©ÏÜåÎπÑ</h4>
                                        <div class="budget-input-group">
                                            <label>Î™©ÌëúÏòàÏÇ∞:</label>
                                            <input type="number" id="shared-budget" placeholder="0">
                                            <span>Ïõê</span>
                                        </div>
                                    </div>
                                    <button class="add-btn" id="add-shared-row">+</button>
                                </div>
                                <div class="table-responsive">
                                    <table class="detail-table" id="shared-detail-table">
                                        <thead>
                                            <tr>
                                                <th style="width: 40px;">No.</th>
                                                <th>ÎÇ¥Ïö©</th>
                                                <th>Í∏àÏï°</th>
                                                <th style="width: 90px;"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="shared-table-body">
                                            <!-- rows added here -->
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <td colspan="2" class="total-label">Ìï©Í≥Ñ</td>
                                                <td colspan="2" class="total-amount" id="shared-total">0Ïõê</td>
                                            </tr>
                                            <tr class="remaining-row">
                                                <td colspan="2" class="total-label">ÎÇ®ÏùÄ Í∏àÏï°</td>
                                                <td colspan="2" class="remaining-amount" id="shared-remaining">0Ïõê</td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div><!-- end detail-grid -->
                </section>

                <section id="stats" class="tab-content active">
                    <div class="stats-layout">
                        <div class="main-stats-area">
                            <div class="summary-grid">
                                <div class="summary-card income">
                                    <h3>Ï¥ùÏàòÏûÖ</h3>
                                    <p class="amount" id="total-income">0Ïõê</p>
                                </div>
                                <div class="summary-card expense">
                                    <h3>Ï¥ùÏßÄÏ∂ú</h3>
                                    <p class="amount" id="total-expense">0Ïõê</p>
                                </div>
                                <div class="summary-card savings">
                                    <h3>Ï¥ùÏ†ÄÏ∂ï</h3>
                                    <p class="amount" id="total-savings">0Ïõê</p>
                                </div>
                            </div>
                            <div class="charts-container">
                                <div class="chart-box">
                                    <h4>Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏÜåÎπÑ %</h4>
                                    <div class="chart-wrapper">
                                        <canvas id="expense-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-box">
                                    <h4>Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Ï†ÄÏ∂ï %</h4>
                                    <div class="chart-wrapper">
                                        <canvas id="savings-chart"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- Asset & Savings Maturity Section -->
                            <div class="section-card mt-4" id="asset-management-section">
                                <div class="section-header">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <h4 style="margin:0;">üè¶ ÏûêÏÇ∞ Î∞è ÎßåÍ∏∞ ÌòÑÌô©</h4>
                                        <div class="total-asset-badge">
                                            Ï¥ù Î≥¥Ïú†ÏûêÏÇ∞: <span id="total-asset-stats-new">0Ïõê</span>
                                        </div>
                                    </div>
                                    <button class="add-btn" id="btn-add-savings" title="Ï†ÅÍ∏à/ÏòàÍ∏à Ï∂îÍ∞Ä">+</button>
                                </div>
                                <div id="savings-list" class="savings-grid">
                                    <!-- Savings items with gauge bars will be injected here -->
                                </div>
                            </div>
                        </div>
                        <!-- Ïö∞Ï∏° Îπà Í≥µÍ∞ÑÏùÑ Ïú†ÏßÄÌïòÏó¨ Îã§Î•∏ ÌÉ≠Í≥º Í∞ÄÎ°ú ÎÑàÎπÑÎ•º ÎßûÏ∂•ÎãàÎã§ -->
                        <div class="details-side"></div>
                    </div>
                </section>

                <!-- Account Book Tab -->
                <section id="account" class="tab-content">
                    <div class="account-layout">
                        <div class="calendar-side">
                            <div id="account-calendar" class="calendar"></div>
                        </div>
                        <div class="details-side">
                            <div class="settings-row"
                                style="margin-bottom: 8px; display: flex; align-items: center; gap: 10px; font-size: 0.85rem; color: var(--text-light); flex-wrap: wrap;">
                                üìÖ Ìïú Îã¨ Í∏∞Ï§Ä: Îß§Ïõî
                                <input type="number" id="setting-salary-day" value="1" min="1" max="28"
                                    style="width: 45px; background: #f7f7ff; border: 1px solid #e4e7ea; color: var(--text); padding: 2px 5px; border-radius: 4px; text-align: center; font-weight: 600;">
                                Ïùº ÏãúÏûë
                            </div>
                            <div id="salary-range-info"
                                style="font-size: 0.75rem; color: var(--text-light); margin-bottom: 12px; display: none;">
                            </div>
                            <div class="summary-grid monthly-summary">
                                <div class="summary-card income clickable" id="acc-income-card">
                                    <h3>Ïù¥Î≤à Îã¨ Ï¥ùÏàòÏûÖ</h3>
                                    <div class="amount" id="acc-monthly-income">0Ïõê</div>
                                </div>
                                <div class="summary-card expense">
                                    <h3>Ïù¥Î≤à Îã¨ Ï¥ùÏÜåÎπÑ</h3>
                                    <div class="amount" id="acc-monthly-expense">0Ïõê</div>
                                </div>
                                <div class="summary-card savings">
                                    <h3>Ïù¥Î≤à Îã¨ Ï¥ùÏ†ÄÏ∂ï</h3>
                                    <div class="amount" id="acc-monthly-savings">0Ïõê</div>
                                </div>
                                <div class="summary-card balance">
                                    <h3>Ïù¥Î≤à Îã¨ ÏûîÏï°</h3>
                                    <div class="amount" id="acc-monthly-balance">0Ïõê</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="account-bottom-sections mt-4">
                        <div class="section-card">
                            <div class="section-header">
                                <h4>ÏÜåÎπÑ Ïπ¥ÌÖåÍ≥†Î¶¨</h4>
                                <button class="add-btn" id="add-expense-cat">+</button>
                            </div>
                            <div id="expense-category-grid" class="category-grid"></div>
                        </div>

                        <div class="section-card mt-4">
                            <div class="section-header">
                                <h4>Ï†ÄÏ∂ï Ïπ¥ÌÖåÍ≥†Î¶¨</h4>
                                <button class="add-btn" id="add-savings-cat">+</button>
                            </div>
                            <div id="savings-category-grid" class="category-grid"></div>
                        </div>
                    </div>
                </section>

                <!-- Life Monthly Tab -->
                <section id="monthly" class="tab-content">
                    <div class="monthly-layout">
                        <div class="calendar-side">
                            <div id="life-calendar" class="calendar"></div>
                        </div>
                        <div class="details-side">
                            <div class="section-card">
                                <div class="section-header">
                                    <h4>Ïù¥Î≤àÎã¨ Ïù¥Ïäà</h4>
                                </div>
                                <div class="todo-input">
                                    <input type="number" id="new-issue-day" placeholder="Ïùº" min="1" max="31">
                                    <input type="text" id="new-issue" placeholder="Ïù¥Ïäà ÏûÖÎ†•...">
                                    <button id="add-issue">Ï∂îÍ∞Ä</button>
                                </div>
                                <ul id="issue-list" class="todo-list"></ul>
                            </div>
                        </div>
                    </div>

                    <div class="section-card mt-4">
                        <div class="section-header">
                            <h4>Í∏∞Î°ù Ï∂îÍ∞Ä</h4>
                        </div>
                        <div class="form-group-row">
                            <input type="number" id="life-day" placeholder="Ïùº" min="1" max="31">
                            <input type="text" id="life-item" placeholder="ÎÇ¥Ïö©">
                            <input type="number" id="life-qty" placeholder="ÏàòÎüâ">
                            <input type="number" id="life-amount" placeholder="Í∏àÏï°">
                            <button id="add-life-log">Í∏∞Î°ù</button>
                        </div>
                    </div>

                    <div class="section-card mt-4">
                        <div class="section-header">
                            <h4>Î≥¥Ïú†Î™©Î°ù</h4>
                        </div>
                        <div class="table-responsive">
                            <table class="stock-table">
                                <thead>
                                    <tr>
                                        <th>ÎÇ†Ïßú</th>
                                        <th>ÎÇ¥Ïö©</th>
                                        <th>ÏàòÎüâ</th>
                                        <th>Í∏àÏï°</th>
                                        <th>Í¥ÄÎ¶¨</th>
                                    </tr>
                                </thead>
                                <tbody id="stock-list-body">
                                    <!-- Í∏∞Î°ùÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Wedding Tab (Image Style) -->
                <section id="wedding" class="tab-content">
                    <div class="detail-card">
                        <div class="wedding-top-nav">
                            <div class="wedding-summary"
                                style="display: flex; gap: 2.5rem; align-items: center; font-size: 0.95rem;">
                                <span style="font-weight: 700; color: #1e293b; margin-right: 0.5rem;">üíç Í≤∞ÌòºÏãù Ï†ïÏÇ∞
                                    ÏöîÏïΩ</span>
                                <div style="width: 1px; height: 16px; background: #e2e8f0;"></div>
                                <span>ÎπÑÏö© ÏßÄÏ∂ú Ìï©Í≥Ñ: <strong id="wedding-expense-total-top"
                                        style="color: var(--danger);">0Ïõê</strong></span>
                                <span>Ï∂ïÏùò Î∞õÏùÄÍ∏àÏï° Ìï©Í≥Ñ: <strong id="wedding-received-total"
                                        style="color: var(--primary);">0Ïõê</strong></span>
                            </div>
                        </div>

                        <div class="wedding-layout-grid">
                            <!-- Left: Wedding Expenses Card -->
                            <div class="section-card">
                                <div class="section-header">
                                    <h4 style="margin:0; font-size: 1.1rem; font-weight: 700; color: #1e293b;">Í≤∞ÌòºÏãù ÎπÑÏö©
                                        Ï¥ùÏ†ïÎ¶¨</h4>
                                    <button class="add-btn" onclick="addWeddingCostGroup()" title="ÎπÑÏö© Í∑∏Î£π Ï∂îÍ∞Ä">+</button>
                                </div>
                                <div id="wedding-costs-wrapper">
                                    <!-- JS will inject groups here as sub-sections -->
                                </div>
                            </div>

                            <!-- Right: Wedding Gifts Card -->
                            <div class="section-card">
                                <div class="section-header">
                                    <h4 style="margin:0; font-size: 1.1rem; font-weight: 700; color: #1e293b;">Ï∂ïÏùòÍ∏à ÎÇ¥Ïó≠
                                    </h4>
                                </div>
                                <div class="table-responsive">
                                    <table class="detail-table wedding-gift-table"
                                        style="border:none; box-shadow:none;">
                                        <thead>
                                            <tr>
                                                <th style="width: 40px;">NO</th>
                                                <th>Ïù¥Î¶Ñ</th>
                                                <th style="width: 100px;">Î∞õÏùÄÍ∏àÏï°</th>
                                                <th style="width: 100px;">ÎÇ∏Í∏àÏï°</th>
                                                <th style="width: 60px;">Ï∞∏ÏÑù</th>
                                                <th style="width: 35px;"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="wedding-gift-table-body"></tbody>
                                        <tfoot style="background: #fdfdfd;">
                                            <tr>
                                                <td colspan="2" class="total-label"
                                                    style="background:transparent; border:none;">Ìï©Í≥Ñ</td>
                                                <td class="total-amount" id="wedding-gifts-received-footer"
                                                    style="background:transparent; border:none; text-align:left; padding-left:0.6rem;">
                                                    0Ïõê</td>
                                                <td class="total-amount" id="wedding-gifts-paid-footer"
                                                    style="background:transparent; border:none; text-align:left; padding-left:0.6rem;">
                                                    0Ïõê</td>
                                                <td colspan="2" style="background:transparent; border:none;"></td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                                <div
                                    style="padding: 0.5rem 0 1rem 0; border-bottom: 1px dashed #eef2f6; margin-bottom: 1.5rem;">
                                    <button class="add-row-mini-btn" onclick="addWeddingGiftRow()"
                                        style="width: 100%; font-size: 0.85rem; background:none; border:none; color:var(--primary); font-weight:700; cursor:pointer;">+
                                        Ï∂ïÏùòÍ∏à ÎÇ¥Ïó≠ Ï∂îÍ∞Ä</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div><!-- End app-body -->


    </div>

    <!-- Data Entry Modal -->
    <div id="entry-modal" class="modal-backdrop">
        <div class="modal-content card">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <h4 id="modal-title">ÎÇ¥Ïó≠ Ï∂îÍ∞Ä</h4>
                    <button id="btn-rename-cat" class="action-icon-btn" title="Ïπ¥ÌÖåÍ≥†Î¶¨Î™Ö Î≥ÄÍ≤Ω"
                        style="display: none;">‚úèÔ∏è</button>
                </div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ÎÇ†Ïßú</label>
                    <input type="date" id="modal-date">
                </div>
                <div class="form-group">
                    <label>Ìï≠Î™©Î™Ö</label>
                    <input type="text" id="modal-name" placeholder="Ìï≠Î™©Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
                <div class="form-group">
                    <label>Í∏àÏï°</label>
                    <input type="number" id="modal-amount" placeholder="Í∏àÏï°ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-entry" class="primary-btn">Ï†ÄÏû•ÌïòÍ∏∞</button>
            </div>
            <div class="modal-history">
                <h5>Í∏∞Ï°¥ ÎÇ¥Ïó≠</h5>
                <div id="modal-entry-list" class="mini-entry-list"></div>
            </div>
        </div>
    </div>

    <!-- Auth Overlay -->
    <div id="auth-overlay" class="modal-backdrop active">
        <div class="modal-content card" style="max-width: 400px; text-align: center;">
            <h2 id="auth-title" style="margin-bottom: 20px;">ÏÇ∂Í∏∞Î°ùÏÜå ÏãúÏûëÌïòÍ∏∞</h2>
            <div class="modal-body">
                <div class="form-group" style="text-align: left;">
                    <label>Ïù¥Î©îÏùº</label>
                    <input type="email" id="auth-email" placeholder="example@email.com">
                </div>
                <div class="form-group" style="text-align: left; margin-bottom: 20px;">
                    <label>ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                    <input type="password" id="auth-password" placeholder="6ÏûêÎ¶¨ Ïù¥ÏÉÅ ÏûÖÎ†•">
                </div>
                <div class="auth-buttons" style="display: flex; gap: 10px;">
                    <button id="btn-login" class="primary-btn" style="flex:1">Î°úÍ∑∏Ïù∏</button>
                    <button id="btn-signup" class="secondary-btn" style="flex:1">ÌöåÏõêÍ∞ÄÏûÖ</button>
                </div>
            </div>
            <p id="auth-msg" style="margin-top: 15px; font-size: 0.85rem; color: var(--text-light);"></p>
        </div>
    </div>

    <!-- Account Day Details Modal -->
    <div id="acc-day-modal" class="modal-backdrop">
        <div class="modal-content card">
            <div class="modal-header">
                <h4 id="acc-day-title">ÎÇ†ÏßúÎ≥Ñ ÏÉÅÏÑ∏ ÎÇ¥Ïó≠</h4>
                <button class="close-modal"
                    onclick="document.getElementById('acc-day-modal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h5 class="section-title">üí∞ ÏÉÅÏÑ∏ ÎÇ¥Ïó≠</h5>
                    <div id="acc-day-list" class="detailed-entry-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Life Day Details Modal -->
    <div id="life-day-modal" class="modal-backdrop">
        <div class="modal-content card">
            <div class="modal-header">
                <h4 id="life-day-title">ÎÇ†ÏßúÎ≥Ñ ÏÉÅÏÑ∏ ÎÇ¥Ïö©</h4>
                <button class="close-modal"
                    onclick="document.getElementById('life-day-modal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h5 class="section-title">üìå Ïù¥Î≤àÎã¨ Ïù¥Ïäà</h5>
                    <div id="life-day-issue-list" class="detailed-entry-list"></div>
                </div>
                <div class="modal-section mt-4">
                    <h5 class="section-title">üìù ÏÉùÌôú Í∏∞Î°ù</h5>
                    <div id="life-day-log-list" class="detailed-entry-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Savings Item Modal -->
    <div id="savings-modal" class="modal-backdrop">
        <div class="modal-content card">
            <div class="modal-header">
                <h4>Ï†ÅÍ∏à/ÏòàÍ∏à Í∏∞Î°ù</h4>
                <button class="close-modal" id="close-savings-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ÏÉÅÌíàÎ™Ö</label>
                    <input type="text" id="savings-name" placeholder="Ïòà: Ï≤≠ÎÖÑÌù¨ÎßùÏ†ÅÍ∏à">
                </div>
                <div class="form-group">
                    <label>Î™©Ìëú Í∏àÏï°</label>
                    <input type="number" id="savings-target-amount" placeholder="0">
                </div>
                <div class="form-group">
                    <label>ÏãúÏûëÏùº</label>
                    <input type="date" id="savings-start-date">
                </div>
                <div class="form-group">
                    <label>ÎßåÍ∏∞Ïùº</label>
                    <input type="date" id="savings-end-date">
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-savings-item" class="primary-btn">Ï†ÄÏû•ÌïòÍ∏∞</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script src="main.js?v=20260224_3"></script>
</body>

</html>